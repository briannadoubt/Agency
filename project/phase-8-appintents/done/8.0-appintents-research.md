---
owner: bri
agent_flow: null
agent_status: idle
branch: implement/8-0-appintents-research
risk: normal
review: not-requested
---

# 8.0 AppIntents Planning

Summary:
Expand the Phase 6 plan to cover AppIntents, ensuring we know what to research, how to integrate, and how to keep builds warning-free.

Acceptance Criteria:
- [x] Document Phase 8 goals for AppIntents, including desired user flows and outcomes
- [x] Call out follow-on cards (e.g., 8.1 AppIntents research) and any additional implementation cards needed
- [x] Capture dependencies/constraints (platform versions, entitlements, privacy copy, Shortcuts surfaces) to inform the plan
- [x] Define validation expectations with warnings-as-errors enabled (unit/UI coverage, simulator setup)

Notes:
- Compile-time warnings are treated as errors; plans must keep the integration clean.
- Coordinate intent surfaces with upcoming UI flows once available.

---

## Phase 8 Goals

### Vision
Expose Agency's core kanban operations via AppIntents so users can interact with their project boards through Siri, Shortcuts, and Spotlight without opening the app.

### Desired User Flows & Outcomes

1. **Voice-driven card queries**: "Hey Siri, show my in-progress cards" returns a list of active tasks.
2. **Move cards via Shortcuts**: Automate workflows like "When I arrive at work, move card X to in-progress."
3. **Quick card creation**: "Create a card in Phase 3 backlog titled 'Fix login bug'" adds a card instantly.
4. **Project status summary**: "What's my project status?" returns counts by status (backlog/in-progress/done).
5. **Spotlight card search**: Type a card title in Spotlight to jump directly to that card.

### Core Intents to Implement

| Intent | Description | Parameters |
|--------|-------------|------------|
| `ListCardsIntent` | Query cards by status/phase | `status`, `phaseNumber` (optional) |
| `MoveCardIntent` | Move a card to a new status | `cardCode`, `targetStatus` |
| `CreateCardIntent` | Create a new backlog card | `phaseNumber`, `title`, `summary` |
| `ProjectStatusIntent` | Return aggregate card counts | none |
| `OpenCardIntent` | Deep-link to a specific card | `cardCode` |

---

## Follow-on Cards

### 8.1 AppIntents Foundation
- Add `AppIntents` framework to project
- Create `AgencyShortcuts` conforming to `AppShortcutsProvider`
- Define core `AppEntity` for Card (`CardEntity`) with display representation
- Implement `ListCardsIntent` as the first intent
- Add Siri entitlement (`com.apple.developer.siri`) to entitlements file

### 8.2 Card Query Intents
- Implement `ProjectStatusIntent` (aggregate counts)
- Add filtering by phase number to `ListCardsIntent`
- Create `CardQuery` conforming to `EntityQuery` for Spotlight integration
- Write unit tests for intent perform() methods

### 8.3 Card Mutation Intents
- Implement `MoveCardIntent` with status validation
- Implement `CreateCardIntent` with phase/title/summary params
- Handle errors gracefully with `IntentError` responses
- Ensure file operations remain on MainActor

### 8.4 Deep Linking & UI Integration
- Implement `OpenCardIntent` with URL scheme or `openAppWhenRun`
- Add `NSUserActivity` donation for recently viewed cards
- Create App Shortcuts phrases in `AppShortcutsProvider`
- Test Spotlight indexing of cards

### 8.5 Testing & Polish
- UI tests for Shortcuts integration (where possible)
- Verify warnings-as-errors compliance
- Add preview/example phrases for each shortcut
- Documentation in AGENTS.md and README updates

---

## Dependencies & Constraints

### Platform Requirements
- **Minimum**: macOS 13.0 (Ventura) — AppIntents framework introduced
- **Recommended**: macOS 14.0+ (Sonoma) — AppShortcutsProvider in extensions, enhanced Siri
- **Target**: macOS 26 (per AGENTS.md) — full Apple Intelligence integration

### Entitlements Required
- `com.apple.developer.siri` (Boolean: true) — enables Siri intent handling

### Info.plist Keys
- `NSUserActivityTypes` — for Spotlight/Handoff card activities
- `INIntentsSupported` / `INIntentsRestrictedWhileLocked` — if using legacy SiriKit bridge

### Privacy Considerations
- No new privacy prompts required for basic intents
- If accessing user files outside sandbox, existing file access entitlements apply
- App Shortcuts require app name in trigger phrases (enforced by framework)

### Shortcuts Surfaces
- **Siri voice**: All intents available via spoken phrases
- **Shortcuts app**: Full automation support with parameters
- **Spotlight**: Card search via `EntityQuery`
- **Action button** (iOS/iPadOS): Not applicable to macOS-only app

---

## Validation Expectations

### Build Requirements
- Zero warnings with warnings-as-errors enabled (`SWIFT_TREAT_WARNINGS_AS_ERRORS = YES`)
- All new code must compile cleanly on macOS 26 SDK

### Test Coverage
- Unit tests for each intent's `perform()` method
- Mock `ProjectLoader` and `CardMover` for isolated testing
- Test error paths (missing card, invalid status transitions)
- Verify `AppEntity` representations render correctly

### Simulator/Device Setup
- Test on macOS 14+ simulator for AppIntents preview
- Verify Shortcuts app recognizes registered shortcuts
- Test Siri invocation in Shortcuts app (voice input limited in simulator)

### Code Quality
- Swift Concurrency only (no DispatchQueues per AGENTS.md)
- `@MainActor` for any UI/file operations
- Use `@Observable` patterns consistent with existing codebase

---

History:
- 2025-11-23: Card created by agent.
- 2025-11-23: Updated to reflect expanded Phase 6 planning needs and linkage to follow-on cards.
- 2025-11-29: Completed Phase 8 planning with goals, follow-on cards, constraints, and validation expectations.
- 2025-11-29: Moved from In Progress to Done.
