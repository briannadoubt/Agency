---
owner: bri
agent_flow: null
agent_status: idle
branch: null
risk: normal
review: not-requested
---

# 9.4 Worker Runtime Extension

Summary:
Extend CodexWorkerRuntime to spawn the `claude` CLI process and stream its output.

Acceptance Criteria:
- [x] Add `claudeCode` flow type detection in `CodexWorkerRuntime`
- [x] Read `claude` binary path from environment or cliArgs
- [x] Read API key from `ANTHROPIC_API_KEY` environment variable
- [x] Spawn `claude -p` process with headless arguments
- [x] Redirect stdout to worker.log file
- [x] Handle process lifecycle (start, waitUntilExit, cleanup)
- [x] Map exit codes to `WorkerRunResult` status

Notes:
- Process spawns inside XPC worker, inherits sandbox context
- Working directory set to project root (from bookmark)
- CLI arguments: `-p`, `--output-format stream-json`, `--allowedTools`, `--max-turns`
- Process termination triggers worker completion

History:
- 2025-11-29: Card created from Phase 9 planning.
- 2025-11-30: Superseded by ClaudeCodeExecutor (card 9.3) which handles process spawning directly in the app process instead of through XPC worker. All acceptance criteria fulfilled via different architecture.
- 2025-11-30: Moved from Backlog to Done.
