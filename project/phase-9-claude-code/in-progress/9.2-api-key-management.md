---
owner: bri
agent_flow: null
agent_status: idle
branch: implement/9-2-api-key-management
risk: normal
review: not-requested
---

# 9.2 API Key Management

Summary:
Implement secure storage and retrieval of Anthropic API key using macOS Keychain.

Acceptance Criteria:
- [x] Implement `ClaudeKeyManager` using Security framework for Keychain access
- [x] Add Settings UI for entering, viewing (masked), and updating API key
- [x] Validate key format (starts with `sk-ant-`)
- [x] Securely pass key to subprocess via environment variable
- [x] Handle missing/invalid key errors with user-friendly messages
- [x] Add "Test Connection" button to verify key validity

Notes:
- Never store API key in UserDefaults or plaintext files
- Use `kSecClassGenericPassword` for Keychain storage
- Service name: `com.briannadoubt.Agency.anthropic-api-key`
- Environment variable: `ANTHROPIC_API_KEY`

History:
- 2025-11-29: Card created from Phase 9 planning.
- 2025-11-30: Implemented ClaudeKeyManager, updated ClaudeCodeSettingsView with API key UI, added unit tests.
