---
owner: bri
agent_flow: null
agent_status: idle
branch: null
risk: normal
review: not-requested
---

# 9.5 Output Parsing & Progress

Summary:
Parse Claude Code's stream-json output and map to existing WorkerLogEvent format for UI display.

Acceptance Criteria:
- [ ] Create `ClaudeStreamParser` to parse newline-delimited JSON
- [ ] Define `ClaudeMessage` types for different message kinds
- [ ] Extract assistant text, tool_use, tool_result messages
- [ ] Parse final result message for cost and duration
- [ ] Map parsed messages to `WorkerLogEvent` (.log, .progress, .finished)
- [ ] Handle malformed JSON gracefully

Notes:
- stream-json format: one JSON object per line
- Key message types: assistant, tool_use, tool_result, result
- Final result contains `total_cost_usd` and `duration_ms`
- Parser runs in worker or app (wherever log is processed)

History:
- 2025-11-29: Card created from Phase 9 planning.
