---
owner: bri
agent_flow: null
agent_status: idle
branch: null
risk: normal
review: not-requested
---

# 9.3 Process Spawning & Execution

Summary:
Create the core subprocess management infrastructure for running Claude Code headless sessions.

Acceptance Criteria:
- [ ] Create `ClaudeCodeRunner` actor for subprocess lifecycle management
- [ ] Set working directory to project root from `ProjectLoader`
- [ ] Build argument list: `-p`, `--output-format stream-json`, `--allowedTools`, `--max-turns`
- [ ] Pass API key via environment from `ClaudeKeyManager`
- [ ] Implement start, cancel, and cleanup operations
- [ ] Handle exit codes and map to meaningful error types
- [ ] Ensure proper cleanup on app termination

Notes:
- Use Swift `Process` API with async/await patterns
- Working directory determines agent's file access scope
- Default allowed tools: `Bash,Read,Write,Edit,Glob,Grep`
- Default max-turns: 50 (configurable per card)
- Exit code 0 = success, non-zero = failure

History:
- 2025-11-29: Card created from Phase 9 planning.
