---
owner: bri
agent_flow: null
agent_status: idle
branch: null
risk: normal
review: not-requested
---

# 9.4 Worker Runtime Extension

Summary:
Extend CodexWorkerRuntime to spawn the `claude` CLI process and stream its output.

Acceptance Criteria:
- [ ] Add `claudeCode` flow type detection in `CodexWorkerRuntime`
- [ ] Read `claude` binary path from environment or cliArgs
- [ ] Read API key from `ANTHROPIC_API_KEY` environment variable
- [ ] Spawn `claude -p` process with headless arguments
- [ ] Redirect stdout to worker.log file
- [ ] Handle process lifecycle (start, waitUntilExit, cleanup)
- [ ] Map exit codes to `WorkerRunResult` status

Notes:
- Process spawns inside XPC worker, inherits sandbox context
- Working directory set to project root (from bookmark)
- CLI arguments: `-p`, `--output-format stream-json`, `--allowedTools`, `--max-turns`
- Process termination triggers worker completion

History:
- 2025-11-29: Card created from Phase 9 planning.
