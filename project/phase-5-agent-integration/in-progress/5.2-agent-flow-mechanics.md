---
owner: bri
agent_flow: null
agent_status: idle
branch: implement/5-2-agent-flow-mechanics
risk: normal
review: not-requested
---

# 5.2 Agent Flow Mechanics

Summary:
App updates frontmatter for agent flows, validates and locks cards, enqueues jobs, and dispatches Codex via XPC with card-relative paths and endpoints as described in `project/XPC_ARCHITECTURE.md`.

Acceptance Criteria:
- [ ] Frontmatter update sequence for agent_flow/agent_status is defined
- [ ] Locking rules prevent concurrent runs on the same card
- [ ] XPC invocation specifies flow, bookmark, card relative path, and the returned endpoint wiring
- [ ] Retry/backoff policy documented; observability (logs/metrics) per run

Notes:
- Include example Codex invocation contract.
- Ensure locking/unlocking integrates with scheduler lifecycle.

Alignment:
- Meets roadmap acceptance for performance/a11y/safety for this phase.
- Preserves markdown structure and frontmatter ordering on save.
- Adds a YYYY-MM-DD entry to History when meaningful changes are made.


History:
- 2025-11-22: Card created by agent.
- 2025-11-26: Moved to in-progress and claimed branch implement/5-2-agent-flow-mechanics.
- 2025-11-26: Authored agent flow mechanics in project/phase-5-agent-integration/agent-flow-mechanics.md covering frontmatter lifecycle, locking, XPC dispatch payload, retry/backoff, and per-run telemetry.
- 2025-11-26: Marked complete and moved to done after review sign-off.
- 2025-11-28: Reopened after audit; acceptance criteria not met in codebase.
